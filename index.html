<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1100">
    <title>MangoMC Store</title>
    <link rel="stylesheet" href="header.css?v=205">
    <link rel="stylesheet" href="structure.css?v=205">
    <link rel="stylesheet" href="design.css?v=205">
    <link rel="stylesheet" href="text.css?v=205">
</head>
<body>

    <header class="top-section">
        <div class="cart-wrapper">
            <div id="cart-logged-out" class="cart-node" onclick="showLogin()">
                <div class="cart-node-text">
                    <span class="node-main">Guest</span>
                    <span class="node-sub">CLICK TO LOGIN</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/MHF_Question/32.png">
                </div>
            </div>

            <div id="cart-logged-in" class="cart-node hidden" onclick="toggleCartMenu()">
                <div class="cart-node-text">
                    <span class="node-main" id="display-name">Username</span>
                    <span class="node-sub" id="cart-total-header">EMPTY CART</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/Steve/32.png" id="user-head">
                </div>
            </div>
        </div>

        <div class="logo-container">
            <img src="logo.png" class="logo">
        </div>
    </header>

    <div id="login-popup" class="modal-overlay hidden">
        <div class="login-card">
            <h2>Enter your username</h2>
            <div class="login-input-row">
                <img src="https://minotar.net/helm/MHF_Question/32.png" id="live-head" class="input-avatar">
                <input type="text" id="mc-username" placeholder="Minecraft Username" oninput="updateLiveHead(this.value)">
            </div>
            <button class="btn-continue" onclick="performLogin()">CONTINUE</button>
            <div class="bedrock-toggle-container">
                <span>Bedrock user?</span>
                <div class="toggle-switch" onclick="toggleBedrock()">
                    <span id="bedrock-status">No</span>
                    <div id="toggle-slider" class="slider-red"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-menu" class="modal-overlay hidden">
        <div class="cart-card">
            <div class="popup-header">
                <img src="" id="popup-head" class="mini-head">
                <div class="popup-user-info">
                  <span id="popup-name">Player</span>
                    <div class="popup-meta">
                        Currency: 
                        <b class="currency-opt active" onclick="setCurrency(this)">Dollars</b> / 
                        <b class="currency-opt" onclick="setCurrency(this)">Coins</b>
                    </div>
                </div>
                <span class="close-popup" onclick="toggleCartMenu()">Ã—</span>
            </div>
            <div class="popup-content">
                <div id="cart-status-msg">Your cart is currently empty.</div>
                <div class="cart-footer">
                    <button class="checkout-btn" onclick="processCheckout()">CHECKOUT</button>
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <aside class="sidebar">
             <div class="sidebar-header">SELECT A CATEGORY</div>
             <div class="nav-item"><img src="ranks.png" class="cat-icon"><span>Ranks</span></div>
             <div class="nav-item"><img src="kits.png" class="cat-icon"><span>Kits</span></div>
             <div class="nav-item"><img src="coins.png" class="cat-icon"><span>Coins</span></div>
             <div class="nav-item"><img src="dollars.png" class="cat-icon"><span>Dollars</span></div>
        </aside>

        <main class="main-content">
            <h2 class="main-title">FEATURED PACKAGES</h2>
            
            <div class="package-row" style="border-color: #4caf50;">
                <img src="ranks.png" class="package-img">
                <div class="package-info">
                    <span class="package-name" style="color: #4caf50;">GOD Rank</span>
                    <span class="package-price">$27.00 / 2,700 Coins</span>
                </div>
                <button class="buy-btn" id="btn-rank_god" onclick="addToCart('GOD Rank', 27.00, 2700, 'ranks', 'rank_god')">BUY</button>
            </div>

            <div class="package-row" style="border-color: #3498db;">
                <img src="ranks.png" class="package-img">
                <div class="package-info">
                    <span class="package-name" style="color: #3498db;">MVP Rank</span>
                    <span class="package-price">$15.00 / 1,500 Coins</span>
                </div>
                <button class="buy-btn" id="btn-rank_mvp" onclick="addToCart('MVP Rank', 15.00, 1500, 'ranks', 'rank_mvp')">BUY</button>
            </div>

            <div class="package-row" style="border-color: #f1c40f;">
                <img src="coins.png" class="package-img">
                <div class="package-info">
                    <span class="package-name" style="color: #f1c40f;">5,000 Coins Bundle</span>
                    <span class="package-price">$10.00 / 1,000 Coins</span>
                </div>
                <button class="buy-btn" onclick="addToCart('5,000 Coins Bundle', 10.00, 1000, 'coins')">BUY</button>
            </div>
        </main>
    </div>

    <script>
        let cart = [];
        let isBedrock = false;
        let activeCurrency = "Dollars";
        let ownedRankId = localStorage.getItem('owned_rank_id');

        window.onload = function() {
            const savedUser = localStorage.getItem('mc_username');
            if (savedUser) applyLoginState(savedUser);
            updateRankUI();
        };

        function applyLoginState(user) {
            document.getElementById('display-name').innerText = user + "'s Cart";
            document.getElementById('popup-name').innerText = user + "'s Cart";
            const headUrl = `https://minotar.net/helm/${user}/32.png`;
            document.getElementById('user-head').src = headUrl;
            document.getElementById('popup-head').src = headUrl;
            document.getElementById('cart-logged-out').classList.add('hidden');
            document.getElementById('cart-logged-in').classList.remove('hidden');
        }

        function performLogin() {
            const user = document.getElementById('mc-username').value.trim();
            if(user !== "") {
                localStorage.setItem('mc_username', user);
                applyLoginState(user);
                document.getElementById('login-popup').classList.add('hidden');
            }
        }

        function setCurrency(element) {
            document.querySelectorAll('.currency-opt').forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
            activeCurrency = element.innerText;
            updateCartDisplay();
        }

        function addToCart(name, usd, coins, category, id = null) {
            if (category === 'ranks' && id === ownedRankId) return alert("You already own this rank!");

            if (category === 'ranks') {
                cart = cart.filter(item => item.category !== 'ranks');
                cart.push({ name, usd, coins, category, id, qty: 1 });
            } else {
                const existing = cart.find(item => item.name === name);
                if (existing) existing.qty += 1;
                else cart.push({ name, usd, coins, category, qty: 1 });
            }
            updateCartDisplay();
            toggleCartMenu();
        }

        function updateCartDisplay() {
            const msg = document.getElementById('cart-status-msg');
            const totalHeader = document.getElementById('cart-total-header');
            if (cart.length === 0) {
                msg.innerText = "Your cart is empty.";
                totalHeader.innerText = "EMPTY CART";
                return;
            }

            let total = 0;
            let symbol = activeCurrency === "Dollars" ? "$" : "";
            let suffix = activeCurrency === "Coins" ? " Coins" : "";
            
            let html = '<ul style="list-style:none; padding:0;">';
            cart.forEach((item, index) => {
                let price = activeCurrency === "Dollars" ? item.usd : item.coins;
                total += (price * item.qty);
                html += `<li style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333;">
                    <span>${item.qty}x ${item.name}</span>
                    <span>${symbol}${(price * item.qty).toLocaleString()}${suffix} <b onclick="removeItem(${index})" style="color:#ff4757; cursor:pointer; margin-left:10px;">[X]</b></span>
                </li>`;
            });
            html += `</ul><div style="text-align:right; color:#ff9f43; font-weight:bold; margin-top:15px; font-size:18px;">TOTAL: ${symbol}${total.toLocaleString()}${suffix}</div>`;
            msg.innerHTML = html;
            totalHeader.innerText = `${symbol}${total.toLocaleString()}${suffix}`;
        }

        function removeItem(index) {
            cart.splice(index, 1);
            updateCartDisplay();
        }

        function updateRankUI() {
            document.querySelectorAll('.buy-btn').forEach(btn => {
                if (btn.id.startsWith('btn-rank')) {
                    if (btn.id === 'btn-' + ownedRankId) {
                        btn.innerText = "OWNED";
                        btn.disabled = true;
                        btn.className = "buy-btn owned";
                    } else {
                        btn.innerText = "BUY";
                        btn.disabled = false;
                        btn.className = "buy-btn";
                    }
                }
            });
        }

        async function processCheckout() {
            const user = localStorage.getItem('mc_username');
            if (!user || cart.length === 0) return alert("Login or add items!");
            
            let total = 0;
            let itemList = "";
            let newRankId = null;
            cart.forEach(item => {
                let p = activeCurrency === "Dollars" ? item.usd : item.coins;
                total += (p * item.qty);
                itemList += `â€¢ ${item.qty}x ${item.name} (${activeCurrency})\n`;
                if (item.category === 'ranks') newRankId = item.id;
            });

            const discordData = {
                embeds: [{
                    title: "ðŸ›’ New Store Order",
                    color: activeCurrency === "Dollars" ? 3066993 : 15844367,
                    thumbnail: { url: `https://minotar.net/helm/${user}/64.png` },
                    fields: [
                        { name: "Player", value: user, inline: true },
                        { name: "Currency", value: activeCurrency, inline: true },
                        { name: "Items", value: itemList },
                        { name: "Total Bill", value: activeCurrency === "Dollars" ? `$${total.toFixed(2)}` : `${total.toLocaleString()} Coins` }
                    ]
                }]
            };

            try {
                await fetch('YOUR_DISCORD_WEBHOOK_URL', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(discordData) });
                if (newRankId) {
                    ownedRankId = newRankId;
                    localStorage.setItem('owned_rank_id', newRankId);
                    updateRankUI();
                }
                alert("Order Placed!");
                cart = [];
                updateCartDisplay();
                toggleCartMenu();
            } catch (e) { alert("Checkout Error"); }
        }

        function toggleBedrock() {
            isBedrock = !isBedrock;
            document.getElementById('bedrock-status').innerText = isBedrock ? "Yes" : "No";
            document.getElementById('toggle-slider').className = isBedrock ? "slider-green" : "slider-red";
        }
        function updateLiveHead(val) { document.getElementById('live-head').src = val.trim() === "" ? "https://minotar.net/helm/MHF_Question/32.png" : `https://minotar.net/helm/${val.trim()}/32.png`; }
        function showLogin() { document.getElementById('login-popup').classList.remove('hidden'); }
        function toggleCartMenu() { document.getElementById('cart-menu').classList.toggle('hidden'); }
    </script>
</body>
</html>
