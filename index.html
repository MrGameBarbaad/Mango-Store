<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1100">
    <title>MangoMC Store</title>
    <link rel="stylesheet" href="header.css?v=204">
    <link rel="stylesheet" href="structure.css?v=204">
    <link rel="stylesheet" href="design.css?v=204">
    <link rel="stylesheet" href="text.css?v=204">
</head>
<body>

    <header class="top-section">
        <div class="cart-wrapper">
            <div id="cart-logged-out" class="cart-node" onclick="showLogin()">
                <div class="cart-node-text">
                    <span class="node-main">Guest</span>
                    <span class="node-sub">CLICK TO LOGIN</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/MHF_Question/32.png">
                </div>
            </div>

            <div id="cart-logged-in" class="cart-node hidden" onclick="toggleCartMenu()">
                <div class="cart-node-text">
                    <span class="node-main" id="display-name">Username</span>
                    <span class="node-sub">EMPTY CART</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/Steve/32.png" id="user-head">
                </div>
            </div>
        </div>

        <div class="logo-container">
            <img src="logo.png" class="logo">
        </div>
    </header>

    <div id="login-popup" class="modal-overlay hidden">
        <div class="login-card">
            <h2>Please enter your username to continue</h2>
            <p>Usernames can't contain spaces, they can have any letter and number, and they are Case Sensitive.</p>
            
            <div class="login-input-row">
                <img src="https://minotar.net/helm/MHF_Question/32.png" id="live-head" class="input-avatar">
                <input type="text" id="mc-username" placeholder="Minecraft Username" oninput="updateLiveHead(this.value)">
            </div>

            <button class="btn-continue" onclick="performLogin()">CONTINUE</button>
            
            <div class="bedrock-toggle-container">
                <span>Bedrock user?</span>
                <div class="toggle-switch" onclick="toggleBedrock()">
                    <span id="bedrock-status">No</span>
                    <div id="toggle-slider" class="slider-red"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-menu" class="modal-overlay hidden">
        <div class="cart-card">
            <div class="popup-header">
                <img src="" id="popup-head" class="mini-head">
                <div class="popup-user-info">
                  <span id="popup-name">Player</span>
                    <div class="popup-meta">
                        <span class="currency">Currency: 
                        <b class="currency-opt active" onclick="setCurrency(this)">Dollars</b> / 
                        <b class="currency-opt" onclick="setCurrency(this)">Coins</b>
                        </span>
                    </div>
                </div>
                <span class="close-popup" onclick="toggleCartMenu()">√ó</span>
            </div>
            <div class="popup-content">
                <h3 class="empty-title">YOUR CART</h3>
                <p id="cart-status-msg">Your cart is currently empty. Add items to proceed!</p>
                
                <div class="cart-footer" style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                    <button class="checkout-btn" onclick="processCheckout()">CHECKOUT</button>
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <aside class="sidebar">
             <div class="sidebar-header">SELECT A CATEGORY</div>
             <div class="nav-item"><img src="coins.png" class="cat-icon"><span>Coins</span></div>
             <div class="nav-item"><img src="ranks.png" class="cat-icon"><span>Ranks</span></div>
             <div class="nav-item"><img src="kits.png" class="cat-icon"><span>Kits</span></div>
             <div class="nav-item"><img src="dollars.png" class="cat-icon"><span>Dollars</span></div>
        </aside>

        <main class="main-content">
            <h2 class="main-title">FEATURED PACKAGES</h2>
    
            <div class="package-row" style="border-color: #4caf50;">
                <img src="ranks.png" class="package-img">
                <div class="package-info">
                    <span class="package-name" style="color: #4caf50;">GOD Rank (+3600 Coins)</span>
                    <span class="package-price">27.00 USD</span>
                </div>
                <button class="buy-btn" onclick="addToCart('GOD Rank')">BUY</button>
            </div>

            <div class="info-section">
                <div class="info-header">WELCOME TO THE OFFICIAL</div>
                <h2 class="info-title">MANGOMC STORE</h2>
                <p>MangoMC is a free-to-play Public Minecraft Server. Items can be purchased here to enhance gameplay and grant the player various special perks. <br><strong>To begin, please select a category from the sidebar.</strong></p>
                
                <div class="info-header" style="margin-top: 25px;">SUPPORT</div>
                <p>Need any questions answered before checkout? Waited more than 20 minutes but your package still has not arrived? Ask the community/staff on Discord, or for payment support, submit a support ticket on our Discord Server. You can also contact us on our Public Contact Email: <span style="color: #ff9f43;">contactmangomc@gmail.com</span></p>
                
                <button class="discord-btn">Discord Server</button>

                <div class="info-header" style="margin-top: 25px; color: #ff4757;">REFUND POLICY</div>
                <p>All payments are final and non-refundable.</p>
                
                <div class="button-row">
                    <button class="red-btn">Terms and Conditions</button>
                    <button class="red-btn">Impressum</button>
                    <button class="red-btn">Privacy Policy</button>
                </div>

                <div class="giftcard-section">
                    <div class="info-header" style="margin-bottom: 12px; display: flex; align-items: center;">
                        <span style="margin-right: 8px; font-size: 14px;">üéÅ</span> GIFTCARD BALANCE
                    </div>
                    <div class="giftcard-box">
                        <input type="text" placeholder="Card Number" class="gift-input">
                        <button class="check-btn">check</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let isBedrock = false;

        window.onload = function() {
            const savedUser = localStorage.getItem('mc_username');
            if (savedUser) {
                applyLoginState(savedUser);
            }
        };

        function applyLoginState(user) {
            document.getElementById('display-name').innerText = user + "'s Cart";
            document.getElementById('popup-name').innerText = user + "'s Cart";
            const headUrl = `https://minotar.net/helm/${user}/32.png`;
            document.getElementById('user-head').src = headUrl;
            document.getElementById('popup-head').src = headUrl;
            
            document.getElementById('cart-logged-out').classList.add('hidden');
            document.getElementById('cart-logged-in').classList.remove('hidden');
        }

        function performLogin() {
            const user = document.getElementById('mc-username').value;
            if(user.trim() !== "") {
                localStorage.setItem('mc_username', user.trim());
                applyLoginState(user.trim());
                hideLogin();
            }
        }

        function toggleBedrock() {
            isBedrock = !isBedrock;
            const statusText = document.getElementById('bedrock-status');
            const slider = document.getElementById('toggle-slider');
            if (isBedrock) {
                statusText.innerText = "Yes";
                slider.className = "slider-green";
            } else {
                statusText.innerText = "No";
                slider.className = "slider-red";
            }
        }

        function updateLiveHead(val) {
            const head = document.getElementById('live-head');
            const cleanName = val.trim();
            head.src = cleanName === "" ? "https://minotar.net/helm/MHF_Question/32.png" : `https://minotar.net/helm/${cleanName}/32.png`;
        }

        function showLogin() { document.getElementById('login-popup').classList.remove('hidden'); }
        function hideLogin() { document.getElementById('login-popup').classList.add('hidden'); }
        function toggleCartMenu() { document.getElementById('cart-menu').classList.toggle('hidden'); }

        function setCurrency(element) {
            document.querySelectorAll('.currency-opt').forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
        }

        function addToCart(itemName) {
            document.getElementById('cart-status-msg').innerText = "1x " + itemName + " - Added to Cart";
            alert(itemName + " has been added to your cart!");
            toggleCartMenu();
        }

        let currentCartItem = "";

        function addToCart(itemName) {
            currentCartItem = itemName;
            document.getElementById('cart-status-msg').innerHTML = `<span style="color:#4caf50; font-weight:bold;">1x ${itemName}</span>`;
            alert(itemName + " added to cart!");
            toggleCartMenu();
        }

        function processCheckout() {
            const user = localStorage.getItem('mc_username');
            const currency = document.querySelector('.currency-opt.active').innerText;
            const webhookURL = 'https://discord.com/api/webhooks/1458664961461977242/r6dlhVmxagCKGw5_7EUWdDlsmwRS67ncB4AB2PRHegIs3QgEYD747JQszc-3iYd34LEm';

            if (!user) {
            alert("Please login first!");
            showLogin();
            return;
        }

        if (currentCartItem === "") {
            alert("Your cart is empty!");
            return;
        }

        // Data to send to Discord
            const discordData = {
            embeds: [{
            title: "üõí New Store Order!",
            color: 16752451, // Orange color
            thumbnail: { url: `https://minotar.net/helm/${user}/64.png` },
            fields: [
                { name: "Player", value: user, inline: true },
                { name: "Item", value: currentCartItem, inline: true },
                { name: "Payment Method", value: currency, inline: true },
                { name: "Time", value: new Date().toLocaleString(), inline: false }
            ],
            footer: { text: "MangoMC Store Logs" }
            }]
        };

        // Send the data to Discord
        fetch(webhookURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(discordData)
        })
            .then(() => {
            alert("Order Placed Successfully! Check Discord.");
        
        // CLEAR THE CART AFTER SUCCESS
            currentCartItem = "";
            document.getElementById('cart-status-msg').innerText = "Your cart is currently empty. Add items to proceed!";
            toggleCartMenu();
        })
            .catch(err => {
            console.error(err);
            alert("Error sending order to Discord.");
        });
        } 
    </script>
</body>
</html>
