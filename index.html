<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MangoMC Store</title>
    <link rel="stylesheet" href="design.css">
</head>
<body>

    <header class="top-section">
        <div class="cart-wrapper">
            <div id="cart-logged-out" class="cart-node" onclick="showLogin()">
                <div class="cart-node-text">
                    <span class="node-main">Guest</span>
                    <span class="node-sub">CLICK TO LOGIN</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/MHF_Question/32.png">
                </div>
            </div>

            <div id="cart-logged-in" class="cart-node hidden" onclick="toggleCartMenu()">
                <div class="cart-node-text">
                    <span class="node-main" id="display-name">Username</span>
                    <span class="node-sub" id="cart-total-header">EMPTY CART</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/Steve/32.png" id="user-head">
                </div>
            </div>
        </div>

        <div class="logo-container">
            <img src="logo.png" alt="MangoMC">
        </div>
    </header>

    <div class="wrapper">
        <aside class="sidebar">
             <div class="sidebar-header">SELECT A CATEGORY</div>
             <div class="nav-item active"><img src="ranks.png" class="cat-icon"><span>Ranks</span></div>
             <div class="nav-item"><img src="kits.png" class="cat-icon"><span>Kits</span></div>
             <div class="nav-item"><img src="coins.png" class="cat-icon"><span>Coins</span></div>
             <div class="nav-item"><img src="dollars.png" class="cat-icon"><span>Dollars</span></div>
        </aside>

        <main class="main-content">
            <h2 class="main-title">FEATURED PACKAGES</h2>
            
            <div class="package-row">
                <img src="ranks.png" class="package-img">
                <span class="package-name">GOD Rank (+3600 Coins)</span>
                <span class="package-price">$27.00 / 2,700 Coins</span>
                <button class="buy-btn" id="btn-rank_god" onclick="addToCart('GOD Rank', 27.00, 2700, 'ranks', 'rank_god')">BUY</button>
            </div>

            <div class="package-row" style="border-left-color: #3498db;">
                <img src="ranks.png" class="package-img">
                <span class="package-name">MVP Rank (+1500 Coins)</span>
                <span class="package-price">$15.00 / 1,500 Coins</span>
                <button class="buy-btn" id="btn-rank_mvp" onclick="addToCart('MVP Rank', 15.00, 1500, 'ranks', 'rank_mvp')">BUY</button>
            </div>

            <div class="package-row" style="border-left-color: #f1c40f;">
                <img src="coins.png" class="package-img">
                <span class="package-name">5,000 Coins Bundle</span>
                <span class="package-price">$10.00 / 1,000 Coins</span>
                <button class="buy-btn" onclick="addToCart('5000 Coins', 10.00, 1000, 'coins')">BUY</button>
            </div>

            <div class="info-section">
                <div class="info-header">WELCOME TO THE OFFICIAL</div>
                <div class="info-title">MANGOMC STORE</div>
                <p>MangoMC is a free-to-play Public Minecraft Server. Items can be purchased here to enhance gameplay and grant the player various special perks.</p>
                
                <div class="info-header">SUPPORT</div>
                <p>Need any questions answered before checkout? Wait more than 20 minutes and your package still hasn't arrived? Contact us on Discord or at: <b>contactmangomc@gmail.com</b></p>
                <button class="discord-btn">Discord Server</button>

                <div class="info-header">REFUND POLICY</div>
                <p>All payments are final and non-refundable.</p>
        
                <div class="button-row">
                    <button class="red-btn">Terms and Conditions</button>
                    <button class="red-btn">Impressum</button>
                    <button class="red-btn">Privacy Policy</button>
                </div>

                <div class="info-header" style="margin-top:25px;">üéÅ GIFTCARD BALANCE</div>
                <div class="giftcard-box">
                    <input type="text" class="gift-input" placeholder="Card Number">
                    <button class="check-btn">check</button>
                </div>
            </div>
        </main>
    </div>

    <div id="login-popup" class="modal-overlay hidden">
        <div class="login-card">
            <h2 style="font-size:16px; margin-bottom:20px;">Enter your username</h2>
            <div style="background:#111; display:flex; align-items:center; padding:5px 15px; border-radius:4px; margin-bottom:15px;">
                <img src="https://minotar.net/helm/MHF_Question/32.png" id="live-head" style="width:24px;">
                <input type="text" id="mc-username" placeholder="Username" oninput="updateLiveHead(this.value)" style="background:transparent; border:none; color:white; padding:12px; outline:none; width:100%;">
            </div>
            <button class="checkout-btn" onclick="performLogin()" style="margin-top:0;">CONTINUE</button>
            <div class="bedrock-toggle-container">
                <span style="font-size:10px; color:#888;">Bedrock user?</span>
                <div class="toggle-switch" onclick="toggleBedrock()">
                    <span id="bedrock-status">No</span>
                    <div id="toggle-slider" class="slider-red"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-menu" class="modal-overlay hidden">
        <div class="cart-card">
            <div style="display:flex; align-items:center; gap:12px; text-align:left; border-bottom:1px solid #333; padding-bottom:15px;">
                <img src="" id="popup-head" style="width:38px; height:38px; border-radius:4px;">
                <div style="flex-grow:1;">
                    <span id="popup-name" style="font-weight:bold; font-size:12px; color:white;">Player</span>
                    <div style="display:flex; gap:6px; margin-top:6px;">
                        <span class="currency-opt active" onclick="setCurrency(this)">Dollars</span>
                        <span class="currency-opt" onclick="setCurrency(this)">Coins</span>
                    </div>
                </div>
                <span onclick="toggleCartMenu()" style="cursor:pointer; color:#555; font-size:22px;">√ó</span>
            </div>
            <div id="cart-status-msg" style="padding:40px 0; color:#555; font-size:11px;">Your cart is currently empty.</div>
            <button class="checkout-btn" onclick="processCheckout()">CHECKOUT</button>
        </div>
    </div>

    <script>
        let cart = [];
        let isBedrock = false;
        let activeCurrency = "Dollars";
        let ownedRankId = localStorage.getItem('owned_rank_id');

        window.onload = function() {
            const savedUser = localStorage.getItem('mc_username');
            if (savedUser) applyLoginState(savedUser);
            updateRankUI();
        };

        function applyLoginState(user) {
            document.getElementById('display-name').innerText = user + "'s Cart";
            document.getElementById('popup-name').innerText = user + "'s Cart";
            const headUrl = `https://minotar.net/helm/${user}/32.png`;
            document.getElementById('user-head').src = headUrl;
            document.getElementById('popup-head').src = headUrl;
            document.getElementById('cart-logged-out').classList.add('hidden');
            document.getElementById('cart-logged-in').classList.remove('hidden');
        }

        function performLogin() {
            const user = document.getElementById('mc-username').value.trim();
            if(user !== "") {
                localStorage.setItem('mc_username', user);
                applyLoginState(user);
                document.getElementById('login-popup').classList.add('hidden');
            }
        }

        function setCurrency(element) {
            document.querySelectorAll('.currency-opt').forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
            activeCurrency = element.innerText;
            updateCartDisplay();
        }

        function addToCart(name, usd, coins, category, id = null) {
            if (!localStorage.getItem('mc_username')) { showLogin(); return; }
            if (category === 'ranks' && id === ownedRankId) return alert("You already own this rank!");

            if (category === 'ranks') {
                cart = cart.filter(item => item.category !== 'ranks');
                cart.push({ name, usd, coins, category, id, qty: 1 });
            } else {
                const existing = cart.find(item => item.name === name);
                if (existing) existing.qty += 1;
                else cart.push({ name, usd, coins, category, qty: 1 });
            }
            updateCartDisplay();
            toggleCartMenu();
        }

        function updateCartDisplay() {
            const msg = document.getElementById('cart-status-msg');
            const totalHeader = document.getElementById('cart-total-header');
            if (cart.length === 0) {
                msg.innerHTML = "Your cart is currently empty.";
                totalHeader.innerText = "EMPTY CART";
                return;
            }

            let total = 0;
            let symbol = activeCurrency === "Dollars" ? "$" : "";
            let suffix = activeCurrency === "Coins" ? " Coins" : "";
            
            let html = '<ul style="list-style:none; padding:0; margin:0; text-align:left;">';
            cart.forEach((item, index) => {
                let price = activeCurrency === "Dollars" ? item.usd : item.coins;
                total += (price * item.qty);
                html += `<li style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333; font-size:12px; color:white;">
                    <span>${item.qty}x ${item.name}</span>
                    <span>${symbol}${(price * item.qty).toLocaleString()}${suffix} <b onclick="removeItem(${index})" style="color:#ff4757; cursor:pointer; margin-left:10px;">[X]</b></span>
                </li>`;
            });
            html += `</ul><div style="text-align:right; color:#ff9f43; font-weight:bold; margin-top:15px; font-size:14px;">TOTAL: ${symbol}${total.toLocaleString()}${suffix}</div>`;
            msg.innerHTML = html;
            totalHeader.innerText = `${symbol}${total.toLocaleString()}${suffix}`;
        }

        function removeItem(index) {
            cart.splice(index, 1);
            updateCartDisplay();
        }

        function updateRankUI() {
            document.querySelectorAll('.buy-btn').forEach(btn => {
                if (btn.id.startsWith('btn-rank')) {
                    if (btn.id === 'btn-' + ownedRankId) {
                        btn.innerText = "OWNED";
                        btn.disabled = true;
                        btn.classList.add('owned');
                    } else {
                        btn.innerText = "BUY";
                        btn.disabled = false;
                        btn.classList.remove('owned');
                    }
                }
            });
        }

        async function processCheckout() {
            const user = localStorage.getItem('mc_username');
            if (!user || cart.length === 0) return alert("Add items to checkout!");
            // ... (Webhook logic remains the same) ...
        }

        function toggleBedrock() {
            isBedrock = !isBedrock;
            document.getElementById('bedrock-status').innerText = isBedrock ? "Yes" : "No";
            document.getElementById('toggle-slider').className = isBedrock ? "slider-green" : "slider-red";
        }

        function updateLiveHead(v) { document.getElementById('live-head').src = v.trim() === "" ? "https://minotar.net/helm/MHF_Question/32.png" : `https://minotar.net/helm/${v.trim()}/32.png`; }
        function showLogin() { document.getElementById('login-popup').classList.remove('hidden'); }
        function toggleCartMenu() { document.getElementById('cart-menu').classList.toggle('hidden'); }
    </script>
</body>
</html>
