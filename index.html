<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MangoMC Store</title>
    <link rel="stylesheet" href="design.css?v=305">
</head>
<body>

    <header class="top-section">
        <div class="logo-container">
            <img src="logo.png" alt="MangoMC Banner" class="logo">
        </div>

        <div class="cart-wrapper">
            <div id="cart-logged-out" class="cart-node" onclick="showLogin()">
                <div class="cart-node-text">
                    <span class="node-main">Guest</span>
                    <span class="node-sub">CLICK TO LOGIN</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/MHF_Question/32.png">
                </div>
            </div>

            <div id="cart-logged-in" class="cart-node hidden" onclick="toggleCartMenu()">
                <div class="cart-node-text">
                    <span class="node-main" id="display-name">Username</span>
                    <span class="node-sub" id="cart-total-header">EMPTY CART</span>
                </div>
                <div class="cart-node-img">
                    <img src="https://minotar.net/helm/Steve/32.png" id="user-head">
                </div>
            </div>
        </div>
    </header>

    <div id="login-popup" class="modal-overlay hidden">
        <div class="login-card">
            <h2 style="color:#fff; margin-bottom:10px;">Enter your username</h2>
            <p style="color:#888; font-size:12px; margin-bottom:20px;">Please enter your Minecraft username to continue.</p>
            <div class="login-input-row" style="background:#1a1a1e; display:flex; align-items:center; padding:5px 15px; border-radius:4px; margin-bottom:20px;">
                <img src="https://minotar.net/helm/MHF_Question/32.png" id="live-head" class="input-avatar" style="width:24px; height:24px;">
                <input type="text" id="mc-username" placeholder="Minecraft Username" oninput="updateLiveHead(this.value)" style="background:transparent; border:none; color:#fff; padding:12px; width:100%; outline:none;">
            </div>
            <button class="btn-continue" onclick="performLogin()" style="background:#d37c15; color:#fff; border:none; width:100%; padding:12px; font-weight:bold; border-radius:4px; cursor:pointer;">CONTINUE</button>
            
            <div class="bedrock-toggle-container" style="display:flex; justify-content:center; align-items:center; gap:15px; margin-top:20px;">
                <span style="color:#888; font-size:12px;">Bedrock user?</span>
                <div class="toggle-switch" onclick="toggleBedrock()">
                    <span id="bedrock-status">No</span>
                    <div id="toggle-slider" class="slider-red"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-menu" class="modal-overlay hidden">
        <div class="cart-card">
            <div class="popup-header">
                <img src="" id="popup-head" class="mini-head" style="width:40px; height:40px; border-radius:4px;">
                <div class="popup-user-info">
                  <span id="popup-name" style="color:#fff; font-weight:bold; display:block;">Player</span>
                    <div class="popup-meta" style="font-size:11px; color:#666; margin-top:5px;">
                        Currency: 
                        <b class="currency-opt active" onclick="setCurrency(this)">Dollars</b> / 
                        <b class="currency-opt" onclick="setCurrency(this)">Coins</b>
                    </div>
                </div>
                <span class="close-popup" onclick="toggleCartMenu()" style="position:absolute; right:20px; top:15px; cursor:pointer; font-size:24px; color:#444;">√ó</span>
            </div>
            <div class="popup-content" style="margin-top:20px; text-align:left;">
                <div id="cart-status-msg">Your cart is currently empty.</div>
                <div class="cart-footer">
                    <button class="checkout-btn" onclick="processCheckout()">CHECKOUT</button>
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <aside class="sidebar">
             <div class="sidebar-header">SELECT A CATEGORY</div>
             <div class="nav-item"><img src="ranks.png" class="cat-icon"><span>Ranks</span></div>
             <div class="nav-item"><img src="kits.png" class="cat-icon"><span>Kits</span></div>
             <div class="nav-item"><img src="coins.png" class="cat-icon"><span>Coins</span></div>
             <div class="nav-item"><img src="dollars.png" class="cat-icon"><span>Dollars</span></div>
        </aside>

        <main class="main-content">
            <h2 class="main-title">FEATURED PACKAGES</h2>
    
            <div class="package-row">
                <img src="ranks.png" class="package-img">
                <div class="package-info" style="flex-grow:1;">
                    <span class="package-name">GOD Rank (+3600 Coins)</span>
                    <span class="package-price">$27.00 / 2,700 Coins</span>
                </div>
                <button class="buy-btn" id="btn-rank_god" onclick="addToCart('GOD Rank', 27.00, 2700, 'ranks', 'rank_god')">BUY</button>
            </div>

            <div class="info-section">
                <div class="info-header">WELCOME TO THE OFFICIAL</div>
                <div class="info-title">MANGOMC STORE</div>
                <p>MangoMC is a free-to-play Public Minecraft Server. Items can be purchased here to enhance gameplay and grant the player various special perks.</p>
                
                <div class="info-header">SUPPORT</div>
                <p>Need any questions answered before checkout? Wait more than 20 minutes and your package still hasn't arrived? Contact us on Discord or at: <b>contactmangomc@gmail.com</b></p>
                <button class="discord-btn">Discord Server</button>

                <div class="info-header">REFUND POLICY</div>
                <p>All payments are final and non-refundable.</p>
        
                <div class="button-row">
                    <button class="red-btn">Terms and Conditions</button>
                    <button class="red-btn">Impressum</button>
                    <button class="red-btn">Privacy Policy</button>
                </div>

                <div class="info-header" style="margin-top:30px;">üéÅ GIFTCARD BALANCE</div>
                <div class="giftcard-box">
                    <input type="text" class="gift-input" placeholder="Card Number">
                    <button class="check-btn">check</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        let cart = [];
        let isBedrock = false;
        let activeCurrency = "Dollars";
        let ownedRankId = localStorage.getItem('owned_rank_id');

        window.onload = function() {
            const savedUser = localStorage.getItem('mc_username');
            if (savedUser) applyLoginState(savedUser);
            updateRankUI();
        };

        function applyLoginState(user) {
            document.getElementById('display-name').innerText = user + "'s Cart";
            document.getElementById('popup-name').innerText = user + "'s Cart";
            const headUrl = `https://minotar.net/helm/${user}/32.png`;
            document.getElementById('user-head').src = headUrl;
            document.getElementById('popup-head').src = headUrl;
            document.getElementById('cart-logged-out').classList.add('hidden');
            document.getElementById('cart-logged-in').classList.remove('hidden');
        }

        function performLogin() {
            const user = document.getElementById('mc-username').value.trim();
            if(user !== "") {
                localStorage.setItem('mc_username', user);
                applyLoginState(user);
                document.getElementById('login-popup').classList.add('hidden');
            }
        }

        function setCurrency(element) {
            document.querySelectorAll('.currency-opt').forEach(opt => opt.classList.remove('active'));
            element.classList.add('active');
            activeCurrency = element.innerText;
            updateCartDisplay();
        }

        function addToCart(name, usd, coins, category, id = null) {
            const user = localStorage.getItem('mc_username');
            if (!user) {
                showLogin();
                return;
            }

            if (category === 'ranks' && id === ownedRankId) return alert("You already own this rank!");

            if (category === 'ranks') {
                cart = cart.filter(item => item.category !== 'ranks');
                cart.push({ name, usd, coins, category, id, qty: 1 });
            } else {
                const existing = cart.find(item => item.name === name);
                if (existing) existing.qty += 1;
                else cart.push({ name, usd, coins, category, qty: 1 });
            }
            updateCartDisplay();
            toggleCartMenu();
        }

        function updateCartDisplay() {
            const msg = document.getElementById('cart-status-msg');
            const totalHeader = document.getElementById('cart-total-header');
            if (cart.length === 0) {
                msg.innerHTML = '<div style="padding:20px; color:#888;">Your cart is empty.</div>';
                totalHeader.innerText = "EMPTY CART";
                return;
            }

            let total = 0;
            let symbol = activeCurrency === "Dollars" ? "$" : "";
            let suffix = activeCurrency === "Coins" ? " Coins" : "";
            
            let html = '<ul style="list-style:none; padding:0; margin:0;">';
            cart.forEach((item, index) => {
                let price = activeCurrency === "Dollars" ? item.usd : item.coins;
                total += (price * item.qty);
                html += `<li style="display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid #333;">
                    <span style="font-size:13px; color:#fff;">${item.qty}x ${item.name}</span>
                    <span style="font-size:13px; color:#ff9f43;">${symbol}${(price * item.qty).toLocaleString()}${suffix} 
                        <b onclick="removeItem(${index})" style="color:#ff4757; cursor:pointer; margin-left:10px; font-size:10px;">[REMOVE]</b>
                    </span>
                </li>`;
            });
            html += `</ul><div style="text-align:right; color:#fff; font-weight:bold; margin-top:20px; font-size:16px;">TOTAL: <span style="color:#ff9f43;">${symbol}${total.toLocaleString()}${suffix}</span></div>`;
            msg.innerHTML = html;
            totalHeader.innerText = `${symbol}${total.toLocaleString()}${suffix}`;
        }

        function removeItem(index) {
            cart.splice(index, 1);
            updateCartDisplay();
        }

        function updateRankUI() {
            document.querySelectorAll('.buy-btn').forEach(btn => {
                if (btn.id.startsWith('btn-rank')) {
                    if (btn.id === 'btn-' + ownedRankId) {
                        btn.innerText = "OWNED";
                        btn.disabled = true;
                        btn.classList.add('owned');
                    } else {
                        btn.innerText = "BUY";
                        btn.disabled = false;
                        btn.classList.remove('owned');
                    }
                }
            });
        }

        async function processCheckout() {
            const user = localStorage.getItem('mc_username');
            if (!user || cart.length === 0) return alert("Please login and add items to your cart!");
            
            let total = 0;
            let itemList = "";
            let newRankId = null;
            cart.forEach(item => {
                let p = activeCurrency === "Dollars" ? item.usd : item.coins;
                total += (p * item.qty);
                itemList += `‚Ä¢ ${item.qty}x ${item.name}\n`;
                if (item.category === 'ranks') newRankId = item.id;
            });

            const webhookBody = {
                embeds: [{
                    title: "üõí New Purchase Request",
                    color: activeCurrency === "Dollars" ? 4388144 : 16752448,
                    thumbnail: { url: `https://minotar.net/helm/${user}/64.png` },
                    fields: [
                        { name: "Player", value: `**${user}** ${isBedrock ? "(Bedrock)" : "(Java)"}`, inline: true },
                        { name: "Currency", value: activeCurrency, inline: true },
                        { name: "Items", value: itemList },
                        { name: "Total Amount", value: activeCurrency === "Dollars" ? `$${total.toFixed(2)}` : `${total.toLocaleString()} Coins` }
                    ],
                    footer: { text: "MangoMC Store Logic" }
                }]
            };

            try {
                // Replace with your actual Discord Webhook URL
                await fetch('YOUR_DISCORD_WEBHOOK_URL', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(webhookBody)
                });

                if (newRankId) {
                    ownedRankId = newRankId;
                    localStorage.setItem('owned_rank_id', newRankId);
                    updateRankUI();
                }

                alert("Checkout successful! Your order has been sent for processing.");
                cart = [];
                updateCartDisplay();
                toggleCartMenu();
            } catch (e) {
                alert("There was an error connecting to the checkout server.");
            }
        }

        function toggleBedrock() {
            isBedrock = !isBedrock;
            document.getElementById('bedrock-status').innerText = isBedrock ? "Yes" : "No";
            document.getElementById('toggle-slider').className = isBedrock ? "slider-green" : "slider-red";
        }

        function updateLiveHead(val) {
            const head = document.getElementById('live-head');
            head.src = val.trim() === "" ? "https://minotar.net/helm/MHF_Question/32.png" : `https://minotar.net/helm/${val.trim()}/32.png`;
        }

        function showLogin() { document.getElementById('login-popup').classList.remove('hidden'); }
        function toggleCartMenu() { document.getElementById('cart-menu').classList.toggle('hidden'); }
    </script>
</body>
</html>
